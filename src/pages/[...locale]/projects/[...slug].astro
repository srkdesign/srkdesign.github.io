---
//Content
import { type CollectionEntry, getCollection, render } from "astro:content";

// Components
import Layout from "../../../layouts/Layout.astro";
import ProjectLayout from "../../../layouts/ProjectLayout";

interface Props {
  project: CollectionEntry<"projects">;
}

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((project) => {
    const parts = project.id.split("/");
    const [localeFromId, slug] = parts.length === 2 ? parts : ["ru", parts[0]];

    const params: { slug: string; locale?: string } = { slug };
    if (localeFromId !== "ru") {
      params.locale = localeFromId;
    }

    return {
      params,
      props: { project },
    };
  });
}

const { project }: Props = Astro.props;
const { locale, slug } = Astro.params;
const actualLocale = locale ?? "ru";
const { Content } = await render(project);
---

<Layout
  title={project.data.title}
  description={project.data.description}
  locale={actualLocale}
>
  <ProjectLayout
    metadata={project.data}
    locale={actualLocale}
    client:only="react"
  >
    <Content />
  </ProjectLayout>
</Layout>
